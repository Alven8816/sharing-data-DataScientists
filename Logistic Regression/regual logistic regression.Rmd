---
title: "Logistic????????"
author: "??????"
date: "2016??5??8??"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## ????

    Logistic?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????ß‘????????????????????????°¬????????????????????°¬??ó®?????????????????????????????????????????????????????®¿?
    ??????????????Logistic???ÔÖ??????????Logistic???Óî????Logistic???˜œExact Logistic Regression??????????Logistic???Óî????Logistic???¸üProbit ??????ßª???????????ßﬁ???????????R???????????ùp?????????????????????????ßµ?????????ß’??????????????????????????????????????????????????????Logistic???¸üR??????
    
## Logistic????????

    Logistic???????????????????????????????????????ß“?y=0??1??????????????????????????????h(x)??0-1????????????????Logistic??????Logistic?????????? sigmoid??????S?????????????????????????®¥??????????????????????????????????÷Œ????????????????¶«????????
    ??????????????????z<0????h(x)<0.5;z>= 0????h(x)>=0.5,??h(x)??0-1 ???? ??????????????????????????????????????????????????????Logistic???ÔÖ????????????????????
    ?ß‡?????????????????????GRE??????????????GPA????????ßµ????????????????????????????????????????????????????y????????y=1????????????y=0????????????????
    
```{r}
#????????
mydata <- read.csv("http://www.ats.ucla.edu/stat/data/binary.csv")
head(mydata)
```

    ??????????????????????????????GRE??????GPA????????ßµ??????????????????????????????????h(x)??????X??????????????y=1????????????????????????h(x)<0.5????????????????????y=0??????????????????????????????????????h(x)??y=1??????????

##Logistic??????????????????
    
    ???????????????????????????????????????????????????????®∞?????????
    
1. ??????????y??????????????????????????????????????

2. ?ß”?????????????????????????????,??????????????????????????????????????????????????????????????????????????????????????????????????????????

3. ????????????Logistic??????????????

4. ????????????????????????

##????????

    ???®¥???????????glm????Logistic????.
    
```{r}
library(aod)
library(ggplot2)
library(Rcpp)
mydata$rank <- factor(mydata$rank)
mylogit <- glm(admit ~ gre + gpa + rank, data = mydata, family = "binomial")
summary(mylogit)
#????95%CI
confint(mylogit)
## odds ratios??OR??????95%CI
exp(cbind(OR = coef(mylogit), confint(mylogit)))
```

    ????????????????????????????Deviance Residuals??beta???? ??P???????? ??????????????Null deviance??Residual deviance??AIC??
    ??????????????GRE??????????????????????????log??????????¶ƒ????????????0.002??GPA??????????????????????????log??????0.804????????????rank??2??????????rank??1????????????????????log??????0.675????????log???»Œ????????????????????????e?»Œ????????????????OR????
    
##??????????????????

    ????wald.test??aod??????rank????????????ßπ?????ß”?????b??????????????Sigma??????????ßø??????????Terms????????????????????????????????Rank??????????3????????¶À??4-6????????20.9??p<0.001,????rank???????????????????â^
    
```{r}
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), Terms = 4:6)
```

    ??????????????rank=2??rank=3???????????????????????????2?????
    ??????5.5??p<0.05,???????????»…????rank=2??rank=3???????????????????????â^
```{r}
l <- cbind(0,0,0,1,-1,0)
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), L = l)
```

##????????

    ?????????????¶Ã?????????????????????????????????????
```{r}
newdata1 <- with(mydata,
  data.frame(gre = mean(gre), gpa = mean(gpa), rank = factor(1:4)))

## view data frame
newdata1
```

```{r}
newdata1$rankP <- predict(mylogit, newdata = newdata1, type = "response")
newdata1
```
    
    ?????????????ßµ???????GRE??GPA,????????????rank=1????????ßµ????????????????????0.517????rank=4??????????????????????0.185????????????????????????????
    ??????????????????????????????????GRE?°¬???rank????????????????????
    
```{r}
newdata2 <- with(mydata,
  data.frame(gre = rep(seq(from = 200, to = 800, length.out = 100), 4),
  gpa = mean(gpa), rank = factor(rep(1:4, each = 100))))
newdata3 <- cbind(newdata2, predict(mylogit, newdata = newdata2, type="link", se=TRUE))
newdata3 <- within(newdata3, {
  PredictedProb <- plogis(fit)
  LL <- plogis(fit - (1.96 * se.fit))
  UL <- plogis(fit + (1.96 * se.fit))
})
head(newdata3)
ggplot(newdata3, aes(x = gre, y = PredictedProb)) +
  geom_ribbon(aes(ymin = LL, ymax = UL, fill = rank), alpha = .2) +
  geom_line(aes(colour = rank), size=1)
```

##????????????

    ????????????????????????????????????summary(mylogit)????????????????????????????????????????????????????????????????????????p<0.001???????????????????â^
    
```{r}
with(mylogit, pchisq(null.deviance - deviance, df.null - df.residual, lower.tail = FALSE))
```

```{r}
####????ROC????
pre <- predict(mylogit,data = mydata[,2:4],type = "response")
library(pROC)
modelroc <- roc(mydata$admit,pre,plot = TRUE,print.thres=TRUE, print.auc=TRUE)
plot(modelroc, print.auc=TRUE, auc.polygon=TRUE, grid=c(0.1, 0.2),
     grid.col=c("green", "red"), max.auc.polygon=TRUE,
     auc.polygon.col="skyblue", print.thres=TRUE)
```
    
    ????????????????AUC??0.693????????????-0.603??????????????????0.744????????0.575.
```{r}
library(caret)
#????????????
pres <- ifelse(pre >= -0.603,1,0)
pres <- as.factor(pres)
mydata$admit <- as.factor(mydata$admit)
xtabs(~pres + mydata$admit)
confusion <- confusionMatrix(pre,mydata$admit)
```

