---
title: "[Visualising]????R??????????????"
author: "??????"
date: "2016??2??20??"
output: html_document
---

    Uber??????????????????????Location-based demand models?????????????¦Ì????????? (Heatmaps)???? ??§¹???????????????????????????????????????????????????????????????????????????????????????????????? ?????????????????????????? ????????????????????????????Heatmap????????????????????

<img src = "http://attach.dataguru.cn/attachments/portal/201506/22/210606xz02wgzpwf73p34p.jpg">

## ????????ggplot2????????????

* ???????????????????????2??Ñs

1. ????????

    ????????????????????????????????????????????????????[City of Chicago Data Portal]<https://data.cityofchicago.org/Public-Safety/motor-vehicle-theft/7ac4-d9tk>.????????????????????2000????????
    
2. ????????

    ??????????????????R????????????????????????????????????????????????strptime??????????????????????????
    
3. ????????????

    ??????????????????¦Ë????????????????????????????????????????
    
4. ????????

    ??????????????????????????????????????????????????
    
###???????????????¡ã???

* ????????

```{r,echo=TRUE,cache=TRUE}
library(ggplot2)
#????????
chicagoMVTs <- read.csv("motor_vehicle_theft.csv",stringsAsFactors = FALSE)
set.seed(1234)
n <- sample(nrow(chicagoMVTs),20000,replace = FALSE)
chicagoMVT <- chicagoMVTs[n,]
head(chicagoMVT)
```

* ????????

```{r,echo=TRUE}
#??????????????????????????
chicagoMVT$Date <- strptime(chicagoMVT$Date, format = "%m/%d/%Y %I:%M:%S")

#????????????????????????
chicagoMVT$Day <- weekdays(chicagoMVT$Date)
chicagoMVT$Hour <- chicagoMVT$Date$hour

#??????????????¦Ë????
dailyCrimes <- as.data.frame(table(chicagoMVT$Day, chicagoMVT$Hour))
names(dailyCrimes) <- c('Day', 'Hour', 'Freq')
dailyCrimes$Hour <- as.numeric(as.character(dailyCrimes$Hour))
dailyCrimes$Day <- factor(dailyCrimes$Day, ordered = TRUE, 
                         levels = c('??????', '??????', '??????', '??????', '??????', '??????', '??????'))
```

* ??????????????????

```{r, echo=TRUE}
library(ggplot2)
ggplot(dailyCrimes,aes(x = Hour, y = Freq))+geom_line(aes(group = Day, color = Day)) +xlab("§³??") +ylab("????????????????") +ggtitle("????????????????????")

```

    ?????§á?????????????????????????????????????????8-12??????????????????????????????????????????????????????????????????
    
* ??????

```{r,echo= TRUE}
ggplot(dailyCrimes, aes( x = Hour, y = Day)) + 
        geom_tile(aes(fill = Freq)) + 
        scale_fill_gradient(name = "????????",low ="white", high = "red" )+
        theme(axis.title.y = element_blank())

```

## ??????????????????????

    ????????????????????ggplot??????????????????????????????????????R??????????????????????????????2??R????maps????ggmap??????????????????????????????dplyr????tidyr????
    
* ?????????????????????Ñs

1. ???????????????????????????????????????????????????????§Þ??????????????????????????????????????????????????????§Ù?????????

2. ??location?§Ù?????latitu??????????longitude??????????location??????x,y????????????????????????????????????x??y?????????????????????§µ?????????????????????????????dplyr??tidyr??

3. ??????????????????????????ggmap????

4. ??¦Ë????????????

* ??????????????????


* ????location??????????????

```{r}
chicagoMVT$Location[chicagoMVT$Location ==""] <- NA
chicagoMVT <- na.omit(chicagoMVT)
nrow(chicagoMVT)
```

    ??????location?§á?????????NA????????????????????20000????????17490????

* ??location?§Ù?????latitu??¦Ã??????longitude????????

```{r,echo=TRUE,cache=TRUE}
library(dplyr)
library(tidyr)
chicagoMVT <- extract(chicagoMVT,Location,c("Latitude","Longitude"),'\\(([^,]+),([^)]+)\\)')
chicagoMVT$Latitude <- round(as.numeric(chicagoMVT$Latitude),2)
chicagoMVT$Longitude <- round(as.numeric(chicagoMVT$Longitude), 2)

```

    extract??????????????tidyr?????????????????§Ö????§³???????????????Location??????Latitude??????Longitude???§µ???????????????????????????Regular Expression or RegEx for short????
    
* ??????????????

```{r,echo = TRUE,cache=TRUE}
library(ggmap)
chicago <- get_map (location = "chicago", zoom = 11)
png(filename = "Chicago.png", width = 800, height = 600, units = "px")
ggmap(chicago)#????????
dev.off() 
```

    ?????????????????????????????§Ö???????????????
    
```{r,echo=TRUE,cache=TRUE}
locationCrimes <- as.data.frame(table(chicagoMVT$Longitude, chicagoMVT$Latitude))
names(locationCrimes) <- c('long', 'lat', 'Frequency')
locationCrimes$long <- as.numeric(as.character(locationCrimes$long))
locationCrimes$lat <- as.numeric(as.character(locationCrimes$lat))
locationCrimes <- subset(locationCrimes, Frequency > 0)
```

    ????????????????????????????????long??????lat??????????????????????????????????????????????????????????????????????latitude??longitude???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????§Ù????????????????§Ö?????????????????????????????????????????????????????????????????????????????
    
*????????????????????

```{r,echo=TRUE,cache=TRUE}
png(filename = "Chicagomap.png", width = 800, height = 600, units = "px")
ggmap(chicago) +
        geom_tile(data = locationCrimes, aes(x = long , y = lat, alpha = Frequency), fill = "red") +
        theme(axis.title.y = element_blank(), axis.title.x = element_blank())
dev.off()
#alpha ??????????????
```

    ??????????????????????????????????????????¡¤???????????????????????t????????????????????????????????????????????????????????????????????????????????????????????????????????????????¦Ï??? <https://www.technologyreview.com/s/428354/la-cops-embrace-crime-predicting-algorithm/>
